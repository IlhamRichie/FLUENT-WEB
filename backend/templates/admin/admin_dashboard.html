{% extends "base.html" %}
{% block title %}Admin Dashboard - FLUENT{% endblock %}
{% block content %}
<div class="admin-dashboard bg-light">
    <div class="container-fluid py-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1 class="h2 fw-bold mb-0">Admin Dashboard</h1>
                <p class="text-muted mb-0">Welcome back, Administrator</p>
            </div>
            <div class="d-flex">
                <!-- Search dan Notifikasi (fungsionalitas perlu diimplementasikan jika diinginkan) -->
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="row mb-4 g-4">
            <div class="col-xl-4 col-md-6">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h3 class="h6 text-muted mb-2">Total Users</h3>
                                <h2 class="fw-bold mb-0">{{ user_count }}</h2>
                                <!-- <small class="text-success"><i class="bi bi-arrow-up"></i> 12% from last month</small> -->
                            </div>
                            <div class="bg-primary bg-opacity-10 p-3 rounded">
                                <i class="bi bi-people-fill text-primary fs-4"></i>
                            </div>
                        </div>
                        <div class="mt-3">
                            <!-- UBAH INI -->
                            <a href="{{ url_for('admin.admin_users_list_route') }}" class="btn btn-sm btn-outline-primary">
                                View All Users <i class="bi bi-arrow-right ms-1"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-4 col-md-6">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h3 class="h6 text-muted mb-2">Today's Sessions</h3>
                                <h2 class="fw-bold mb-0">{{ today_sessions }}</h2>
                                <!-- <small class="text-success"><i class="bi bi-arrow-up"></i> 5 new today</small> -->
                            </div>
                            <div class="bg-info bg-opacity-10 p-3 rounded">
                                <i class="bi bi-activity text-info fs-4"></i>
                            </div>
                        </div>
                        <div class="mt-3">
                            <!-- UBAH INI -->
                            <a href="{{ url_for('admin.admin_sessions_route') }}" class="btn btn-sm btn-outline-info">
                                View Sessions <i class="bi bi-arrow-right ms-1"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-4 col-md-6">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h3 class="h6 text-muted mb-2">System Status</h3>
                                <h2 class="fw-bold mb-0">Active</h2>
                                <small class="text-success">All services running</small>
                            </div>
                            <div class="bg-success bg-opacity-10 p-3 rounded">
                                <i class="bi bi-check-circle-fill text-success fs-4"></i>
                            </div>
                        </div>
                        <div class="mt-3">
                            <span class="badge bg-success bg-opacity-10 text-success">
                                <i class="bi bi-check-circle me-1"></i> All Systems Operational
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Visualization Charts -->
        <div class="row mb-4 g-4">
            <div class="col-lg-6">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-header bg-white border-0 py-3">
                        <h3 class="h5 mb-0 fw-bold">User Registration Trend</h3>
                    </div>
                    <div class="card-body">
                        <div id="registrationChart" style="height: 300px;">
                            {{ registration_chart|safe if registration_chart else "<p class='text-center text-muted'>No registration data to display.</p>" }}
                        </div>
                        <!-- Legend bisa di-generate oleh Plotly atau di-custom -->
                    </div>
                </div>
            </div>

            <div class="col-lg-6">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-header bg-white border-0 py-3">
                        <h3 class="h5 mb-0 fw-bold">User Demographics</h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div id="genderChart" style="height: 250px;">
                                    {{ gender_chart|safe if gender_chart else "<p class='text-center text-muted'>No gender data.</p>" }}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div id="occupationChart" style="height: 250px;">
                                    {{ occupation_chart|safe if occupation_chart else "<p class='text-center text-muted'>No occupation data.</p>" }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Users Table (Overview - mungkin link ke halaman user list yang lebih detail) -->
        <div class="card border-0 shadow-sm" id="users-table-overview"> <!-- ID diubah agar unik -->
            <div class="card-header bg-white border-0 py-3">
                <div class="d-flex justify-content-between align-items-center">
                    <h3 class="h5 mb-0 fw-bold">Recently Registered Users (Overview)</h3>
                    <div>
                        <!-- UBAH INI -->
                        <a href="{{ url_for('admin.admin_users_list_route') }}" class="btn btn-sm btn-outline-primary">
                            Manage All Users <i class="bi bi-arrow-right ms-1"></i>
                        </a>
                        <!-- Tombol Add User bisa di halaman user list yang detail -->
                    </div>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th class="ps-4">#</th>
                                <th>User</th>
                                <th>Email</th>
                                <th>Status</th>
                                <th class="pe-4">Registered</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if all_users and all_users|length > 0 %} <!-- 'all_users' adalah variabel dari dashboard lama, pastikan ini ada -->
                            {% for user in all_users %} <!-- Batasi jumlahnya jika ini overview, misal all_users[:5] -->
                            <tr>
                                <td class="ps-4 text-muted">{{ loop.index }}</td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="avatar-sm me-2">
                                            <div class="avatar-title bg-{% if user.is_admin %}danger{% else %}primary{% endif %}-subtle text-{% if user.is_admin %}danger{% else %}primary{% endif %} rounded-circle">
                                                {{ user.username[0]|upper if user.username else 'U' }}
                                            </div>
                                        </div>
                                        <div>
                                            <div class="fw-medium">{{ user.username }}</div>
                                            <small class="text-muted">{% if user.is_admin %}Admin{% else %}User{% endif %}</small>
                                        </div>
                                    </div>
                                </td>
                                <td>{{ user.email }}</td>
                                <td>
                                    <span class="badge bg-{% if user.is_active %}success{% else %}warning{% endif %}-subtle text-{% if user.is_active %}success{% else %}warning{% endif %}">
                                        {% if user.is_active %}Active{% else %}Inactive{% endif %}
                                    </span>
                                </td>
                                <td class="pe-4">
                                    <div class="fw-medium">{{ user.created_at.strftime('%b %d, %Y') if user.created_at else 'N/A' }}</div>
                                    <small class="text-muted">{{ user.created_at.strftime('%H:%M') if user.created_at else '' }}</small>
                                </td>
                            </tr>
                            {% endfor %}
                            {% else %}
                            <tr><td colspan="5" class="text-center text-muted py-3">No recent users to display.</td></tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- User Activity Overview -->
        <div class="row my-4 g-4"> <!-- Tambah margin y -->
            <div class="col-12">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white border-0 py-3">
                        <h3 class="h5 mb-0 fw-bold">Daily Interview Sessions (Last 30 Days)</h3> <!-- Ubah judul -->
                    </div>
                    <div class="card-body">
                        <div id="activityChart" style="height: 350px;">
                            {{ activity_chart|safe if activity_chart else "<p class='text-center text-muted'>No activity data to display.</p>" }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Recent Activity (Contoh, data perlu disiapkan di backend) -->
    </div>
</div>

<!-- Add User Modal (Mungkin lebih cocok di halaman admin_users_list.html) -->

<style>
    /* ... (style Anda sebelumnya) ... */
</style>

<!-- Plotly CDN sudah ada di base.html atau perlu di sini jika base.html tidak selalu punya -->
<!-- <script src="https://cdn.plot.ly/plotly-latest.min.js"></script> -->
<script>
    // ... (script Anda sebelumnya) ...
</script>
{% endblock %}